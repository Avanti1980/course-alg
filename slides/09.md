---
presentation:
  margin: 0
  center: false
  transition: "convex"
  enableSpeakerNotes: true
  slideNumber: "c/t"
  navigationMode: "linear"
---

@import "../css/font-awesome-4.7.0/css/font-awesome.css"
@import "../css/theme/solarized.css"
@import "../css/logo.css"
@import "../css/font.css"
@import "../css/color.css"
@import "../css/margin.css"
@import "../css/table.css"
@import "../css/main.css"
@import "../plugin/zoom/zoom.js"
@import "../plugin/customcontrols/plugin.js"
@import "../plugin/customcontrols/style.css"
@import "../plugin/chalkboard/plugin.js"
@import "../plugin/chalkboard/style.css"
@import "../plugin/menu/menu.js"

<!-- slide id="front-page" data-notes="" -->

<div class="bottom20"></div>

# 算法设计与分析

<hr class="width70 center">

## 分支限界法

<div class="bottom8"></div>

### 计算机学院 &nbsp;&nbsp; 张腾

#### _tengzhang@hust.edu.cn_

<!-- slide vertical=true data-notes="" -->

##### 课程大纲

---

@import "../vega/outline-bb.json" {as="vega" .top-2}

<!-- slide data-notes="" -->

##### 分支限界法

---

分支限界法：{==对穷举法的改进==}，{==带剪枝的搜索==}

状态空间树生长的两种策略：

- {==回溯==}：{==深度优先==}，E-结点 R 每生成一个新的儿子 C 时，C 就变成了新的 E-结点，当完全检测了子树 C 之后，R 结点再次成为 E-结点
- {==分支限界==}：{==宽度优先==}，在生成当前 E-结点全部儿子之后再生成其它活结点的儿子

<div class="top2"></div>

存储活结点的数据结构

- {==队列==}：先进先出，对状态生成树做 BFS
- {==栈==}：后进先出，对状态生成树做 D-Search

<!-- slide data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 1 得新结点 2、3、4、5

<div class="top-2"></div>

活结点 2、3、4、5 入队

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder bottom2">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |  队列  |   2    |   3    |   4    |   5    | &ensp; | &ensp; |

</div>

扩展结点 2 得新结点 6、7、8

<div class="top-2"></div>

利用限界函数杀死结点 6

<div class="top-2"></div>

活结点 7、8 入队

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |  队列  |   3    |   4    |   5    |   7    |   8    | &ensp; |

</div>

@import "../dot/four-queen-bb-solve1.dot" {.top-50per .left60per}

@import "../dot/four-queen-bb-solve2.dot" {.top9per .left55per}

<!-- slide vertical=true data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 3 得新结点 9、10、11

<div class="top-2"></div>

利用限界函数杀死结点 9、10

<div class="top-2"></div>

活结点 11 入队

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder bottom2">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |  队列  |   4    |   5    |   7    |   8    |   11   | &nbsp; |

</div>

扩展结点 4 得新结点 12、13、14

<div class="top-2"></div>

利用限界函数杀死结点 13、14

<div class="top-2"></div>

活结点 12 入队

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |  队列  |   5    |   7    |   8    |   11   |   12   | &nbsp; |

</div>

@import "../dot/four-queen-bb-solve3.dot" {.top-56per .left56per}

@import "../dot/four-queen-bb-solve4.dot" {.top7per .left50per}

<!-- slide vertical=true data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 5 得新结点 15、16、17，利用限界函数杀死结点 17

<div class="top-2"></div>

活结点 15、16 入队

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |  队列  |   7    |   8    |   11   |   12   |   15   |   16   |

</div>

@import "../dot/four-queen-bb-solve5.dot" {.center .top0}

<!-- slide vertical=true data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 7 得新结点 18、19，利用限界函数杀死结点 18、19

<div class="top-2"></div>

扩展结点 8 得新结点 20、21，利用限界函数杀死结点 21

<div class="top-2"></div>

活结点 20 入队

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |  队列  |   11   |   12   |   15   |   16   |   20   | &nbsp; |

</div>

@import "../dot/four-queen-bb-solve6.dot" {.center .top0}

<!-- slide vertical=true data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 11 得新结点 22、23，利用限界函数杀死结点 23

<div class="top-2"></div>

活结点 22 入队

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |  队列  |   12   |   15   |   16   |   20   |   22   | &nbsp; |

</div>

@import "../dot/four-queen-bb-solve7.dot" {.center .top0}

<!-- slide vertical=true data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 12 得新结点 24、25，利用限界函数杀死结点 24

<div class="top-2"></div>

活结点 25 入队

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |  队列  |   15   |   16   |   20   |   22   |   25   | &nbsp; |

</div>

@import "../dot/four-queen-bb-solve8.dot" {.center .top0}

<!-- slide vertical=true data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 15 得新结点 26、27，利用限界函数杀死结点 26

<div class="top-2"></div>

活结点 27 入队

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |  队列  |   16   |   20   |   22   |   25   |   27   | &nbsp; |

</div>

@import "../dot/four-queen-bb-solve9.dot" {.center .top0}

<!-- slide vertical=true data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 16 得新结点 28、29，利用限界函数杀死结点 28、29

<div class="top-2"></div>

扩展结点 20 得新结点 30，利用限界函数杀死结点 30

<div class="top-2"></div>

扩展结点 22 得答案结点 31，对应元组为$(2,4,1,3)$

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |  队列  |   25   |   27   | &nbsp; | &nbsp; | &nbsp; | &nbsp; |

</div>

@import "../dot/four-queen-bb-solve10.dot" {.left22per .top-6per}

<!-- slide vertical=true data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 25 得答案结点 32，对于元组为$(3,1,4,2)$

<div class="top-2"></div>

扩展结点 27 得新结点 33，利用限界函数杀死结点 33

<div class="top-2"></div>

队列为空，再无可扩展活结点，算法停止，两个解均已找到

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |  队列  | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |

</div>

@import "../dot/four-queen-bb-solve11.dot" {.left22per .top-6per}

<!-- slide data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 1 得新结点 2、3、4、5

<div class="top-2"></div>

活结点 2、3、4、5 入栈

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder bottom2">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |   栈   |   2    |   3    |   4    |   5    | &ensp; | &ensp; |

</div>

扩展结点 5 得新结点 6、7、8

<div class="top-2"></div>

用限界函数杀死结点 8

<div class="top-2"></div>

活结点 6、7 入栈

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |   栈   |   2    |   3    |   4    |   6    |   7    | &ensp; |

</div>

@import "../dot/four-queen-bb-solve1.dot" {.top-50per .left60per}

@import "../dot/four-queen-bb-stack2.dot" {.top9per .left55per}

<!-- slide vertical=true data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 7 得新结点 9、10，用限界函数杀死结点 9、10

<div class="top-2"></div>

扩展结点 6 得新结点 11、12，用限界函数杀死结点 11

<div class="top-2"></div>

活结点 12 入栈

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder bottom2">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |   栈   |   2    |   3    |   4    |   12   | &nbsp; | &nbsp; |

</div>

@import "../dot/four-queen-bb-stack3.dot" {.top-12per .left48per}

<!-- slide vertical=true data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 12 得新结点 13，用限界函数杀死结点 13

<div class="top-2"></div>

扩展结点 4 得新结点 14、15、16，用限界函数杀死结点 15、16

<div class="top-2"></div>

活结点 14 入栈

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder bottom2">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |   栈   |   2    |   3    |   14   | &nbsp; | &nbsp; | &nbsp; |

</div>

@import "../dot/four-queen-bb-stack4.dot" {.top-12per .left45per}

<!-- slide vertical=true data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 14 得新结点 17、18，用限界函数杀死结点 17

<div class="top-2"></div>

活结点 18 入栈

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder bottom2">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |   栈   |   2    |   3    |   18   | &nbsp; | &nbsp; | &nbsp; |

</div>

@import "../dot/four-queen-bb-stack5.dot" {.top-12per .left45per}

<!-- slide vertical=true data-notes="" -->

##### <span style="font-weight:900">4</span>-皇后问题 分支限界

---

扩展结点 18 得答案结点 19，对应元组为$(3,1,4,2)$

<div class="top-2"></div>

另一个解$(2,4,1,3)$可从结点 3 继续扩展得到

<div class="top-7 left2 righta tighttable row1-1-column2-7-fullborder bottom2">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|   >    |   栈   |   2    |   3    | &nbsp; | &nbsp; | &nbsp; | &nbsp; |

</div>

@import "../dot/four-queen-bb-stack6.dot" {.top-8per .left45per}

<!-- slide data-notes="" -->

##### 分支限界 改进

---

分支限界每步对下一个 E-结点的选择过于死板

如何聪明地选择 E-结点？

对结点给出优先级，让可导出答案结点的活结点有高优先级

<div class="top4"></div>

结点代价：用该结点导致答案结点所需的成本

对任一结点$X$

- 在生成一个答案结点之前，其子树需要生成的总结点数
- 在子树中离$X$最近的那个答案结点到$X$的路径长度

<!-- slide vertical=true data-notes="" -->

##### 结点代价

---

答案结点为 31，故通过路径长度定义的结点代价

<div class="threelines left6 righta top-1 bottom-1">

| 结点 |  1  |  3  | 11  | 22  |  2  |
| :--: | :-: | :-: | :-: | :-: | :-: |
| 成本 |  4  |  3  |  2  |  1  |  ∞  |

</div>

@import "../dot/four-queen-bb-solve11.dot" {.left25 .top-4 .bottom-10}

<!-- slide vertical=true data-notes="" -->

##### 结点成本估计函数

---

计算结点$X$的代价要完整检索子树才能确定

因此计算$C(X)$的复杂度与解原始问题是相同

<div class="top4"></div>

结点成本估计函数$\hat{c}(X) = \hat{g}(X) + f(h(X))$

- $\hat{g}(X)$由$X$到达一个答案结点所需成本的估计函数
- $f(\cdot)$是单调增函数，$h(X)$为根结点到结点$X$的成本，已发生成本

<div class="top4"></div>

我的批注 引入$h(X)$是为了避免单纯考虑$\hat{g}(X)$造成的“孤军深入”，它迫使算法优先检索{==靠近答案结点==}同时又{==离根较近==}的结点

<!-- slide data-notes="" -->

##### 华容道问题

---

问题描述：通过合法移动，将左边的棋盘变成右边的状态

合法移动：每次将一个邻接于空格的牌移动到空格位置

<div class="top-2 tighttable row1-4-column1-4-fullborder row1-4-column8-11-fullborder bottom4">

| &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |      &ensp;       | &ensp; | &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: | :----: | :---------------: | :----: | :----: | :----: | :----: | :----: |
|   1    |   3    |   4    |   15   | &ensp; |      &ensp;       | &ensp; |   1    |   2    |   3    |   4    |
|   2    | &ensp; |   5    |   12   | &ensp; | $\Longrightarrow$ | &ensp; |   5    |   6    |   7    |   8    |
|   7    |   6    |   11   |   14   | &ensp; |      &ensp;       | &ensp; |   9    |   10   |   11   |   12   |
|   8    |   9    |   10   |   13   | &ensp; |      &ensp;       | &ensp; |   13   |   14   |   15   | &ensp; |

</div>

目标状态是否可由初始状态到达？

<!-- slide vertical=true data-notes="" -->

##### 华容道 可达性

---

记$p(i)$为编号$i$的牌在初始状态中的位置，$p(16)$为空格的位置

记$l(i)$为编号小于$i$但初始位置在$i$之后的牌的数目

引入变量$q$，若空格初始在蓝色格上，$q=1$，否则为零

当且仅当$\sum_{i=1}^{16} l(i) + q$为偶数时，目标状态可达

<div class="top0 row0-3-column1-4-fullborder chessboard-blue-even">

| &ensp; | &ensp; | &ensp; | &ensp; |
| :----: | :----: | :----: | :----: |
| &ensp; | &ensp; | &ensp; | &ensp; |
| &ensp; | &ensp; | &ensp; | &ensp; |
| &ensp; | &ensp; | &ensp; | &ensp; |

</div>

<!-- slide vertical=true data-notes="" -->

##### 华容道 分支限界

---

@import "../dot/klotski.dot" {.center .top1 .bottom-10}

<!-- slide vertical=true data-notes="" -->

##### 华容道 分支限界 改进

---

<div class="top2"></div>

- $f(h(X))$取根结点到$X$的路径长度
- $\hat{g}(X)$为不在其正确位置的牌数目

@import "../dot/klotski-lc.dot" {.left40per .top-10per .bottom-10}
