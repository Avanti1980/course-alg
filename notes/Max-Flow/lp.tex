\documentclass{ctexart}
\usepackage{avanti-color}
\usepackage{avanti-font}
\usepackage{avanti-math}
\usepackage{avanti-theorem}
\usepackage{avanti-others}

\tikzset{font=\large}
\tikzset{base/.style={smooth, very thick, Solarized-base03}}
\tikzset{point/.style={circle, minimum height=0.8cm, base, draw=Solarized-base03, fill=Solarized-base2}}
\tikzset{arrow/.style={->, -{Stealth[scale=0.8]}, base}}

\begin{document}
\title{\bf{线性规划、单纯形法}}
\author{张腾\thanks{tengzhang@hust.edu.cn}}
%\affil{华中科技大学~计算机学院}
\date{\today}
\maketitle

线性规划是在一组线性等式或不等式的约束下，求线性目标函数最值的问题，现实中的许多问题都可化为线性规划问题。

\begin{example} [分数背包问题] \label{exam: bag}
    设背包承重量为$10$，各物品价值如下：
    \begin{align*}\arraycolsep=10.0pt
        \begin{array}{r|cccc} \hline
               & 物品$1$ & 物品$2$ & 物品$3$ & 物品$4$ \\ \hline
            重量 & 4     & 7     & 5     & 3     \\
            价值 & 40    & 42    & 25    & 12    \\ \hline
        \end{array}
    \end{align*}
    现允许物品按比例取走部分，求最大装包方案。

    对$i \in [4]$，设物品$i$取走的比例为$x_i$，可得如下线性规划
    \begin{align*}
        \begin{array}{rl}
            \max & 40 x_1 + 42 x_2 + 25 x_3 + 12 x_4    \\
            \st  & 4 x_1 + 7 x_2 + 5 x_3 + 3 x_4 \le 10 \\
                 & 0 \le x_i \le 1, ~ i \in [4]
        \end{array}
    \end{align*}
\end{example}

\begin{remark}
    如果不允许只取部分(0/1背包问题)，约束$0 \le x_1, x_2, x_3, x_4 \le 1$将变成$x_1, x_2, x_3, x_4 \in \{0, 1\}$，此时问题就变成了整数线性规划，比线性规划要难得多。
\end{remark}

\begin{example} [最大流] \label{exam: flow}
    给定如下的流网络，求最大流。
    \begin{figure}[h]
        \centering
        \begin{tikzpicture}

            \pgfmathsetmacro{\l}{3.5};

            \node [point] (s) at (0,0) {$\sv$};
            \path (s) ++(30:\l)  node[point] (v1) {$\vv_1$};
            \path (s) ++(330:\l)  node[point] (v2) {$\vv_2$};
            \path (v1) ++(\l,0)  node[point] (v3) {$\vv_3$};
            \path (v2) ++(\l,0)  node[point] (v4) {$\vv_4$};
            \path (v4) ++(30:\l)  node[point] (t) {$\tv$};

            \draw [arrow] (s) -- (v1) node [above=0pt, sloped, pos=0.5] {$16$};
            \draw [arrow] (s) -- (v2) node [below=0pt, sloped, pos=0.4] {$13$};
            \draw [arrow] (v2) -- (v1) node [above=0pt, sloped, pos=0.5] {$4$};
            \draw [arrow] (v1) -- (v3) node [above=0pt, pos=0.5] {$12$};
            \draw [arrow] (v2) -- (v4) node [below=0pt, pos=0.5] {$14$};
            \draw [arrow] (v4) -- (v3) node [above=0pt, sloped, pos=0.5] {$7$};
            \draw [arrow] (v3) -- (v2) node [above=0pt, sloped, pos=0.5] {$9$};
            \draw [arrow] (v3) -- (t) node [above=0pt, sloped, pos=0.5] {$20$};
            \draw [arrow] (v4) -- (t) node [below=0pt, sloped, pos=0.5] {$4$};

        \end{tikzpicture}
    \end{figure}

    设$9$条边上的流量分别为$x_1, \ldots, x_9$，可得如下线性规划
    \begin{align*}
        \begin{array}{rl}
            \max & x_1 + x_2                 \\
            \st  & 0 \le x_1 \le 16          \\
                 & 0 \le x_2 \le 13          \\
                 & 0 \le x_3 \le 4           \\
                 & 0 \le x_4 \le 12          \\
                 & 0 \le x_5 \le 9           \\
                 & 0 \le x_6 \le 14          \\
                 & 0 \le x_7 \le 7           \\
                 & 0 \le x_8 \le 20          \\
                 & 0 \le x_9 \le 4           \\
                 & x_1 + x_3 - x_4 = 0       \\
                 & x_2 + x_5 - x_3 - x_6 = 0 \\
                 & x_4 + x_7 - x_5 - x_8 = 0 \\
                 & x_6 - x_7 - x_9 = 0
        \end{array}
    \end{align*}
    其中前$9$个不等式约束对应容量限制，后$4$个等式约束对应流量守恒。
\end{example}

$\Rbb^2$中的线性规划只有$2$个变量，线性目标函数和线性等式约束是一条直线，线性不等式约束是一个半平面，可采用图解法。

\begin{example} [图解法示例] \label{exam: illustration}
    考虑如下线性规划
    \begin{align*}
        \begin{array}{rl}
            \max & 3 x_1 + 5 x_2      \\
            \st  & x_1 + 5 x_2 \le 40 \\
                 & 2 x_1 + x_2 \le 20 \\
                 & x_1 + x_2 \le 12   \\
                 & x_1,x_2 \ge 0
        \end{array}
    \end{align*}

    先确定\blue{可行域}，即满足所有约束的\blue{可行解}构成的集合。该例中共有$5$个线性不等式约束，每个对应一个半平面，因此可行域为$5$个半平面相交出的凸五边形(图\ref{fig: lp}中红色部分)。

    引入直线簇$y = 3 x_1 + 5 x_2$，其中不同的$y$对应不同的直线，这些直线都是平行的。先将$y$取为一个较大的值使直线与凸五边形不相交，然后逐渐减小$y$，这相当于从上向下平移直线$y = 3 x_1 + 5 x_2$使其逐渐靠近凸五边形，当其与凸五边形相切时，切点就是\blue{最优解}，
    \begin{figure}[h]
        \centering
        \tikzset{font=\small}
        \begin{tikzpicture}[scale=0.7]

            \draw [arrow] (-0.5,0) -- (14,0) node[above] {$x_1$};
            \draw [arrow] (0,-0.5) -- (0,9.5) node[right] {$x_2$};

            \draw [base,thin,dashed] (-0.5,8.1) -- (10,6) node [above=0pt, sloped, pos=0.2] {$x_1 + 5 x_2 \le 40$};
            \draw [base,thin,dashed] (10.2,-0.4) -- (5,10) node [above=0pt, sloped, pos=0.85] {$2 x_1 + x_2 \le 20$};
            \draw [base,thin,dashed] (12.2,-0.2) -- (2,10) node [above=0pt, sloped, pos=0.12] {$x_1 + x_2 \le 12$};

            \draw [base] (1,9.4) -- (13,2.2) node [above=0pt, sloped, pos=0.85] {$3 x_1 + 5 x_2 = 50$};

            \draw [base] (0,0) -- (10,0) -- (8,4) -- (5,7) -- (0,8) -- cycle;
            \fill [Solarized-red,opacity=0.5] (0,0) -- (10,0) -- (8,4) -- (5,7) -- (0,8) -- cycle;

            \path (0, -0.4) node[draw=none,left] () {$(0,0)$};
            \path (9.6, 0) node[draw=none,below] () {$(10,0)$};
            \path (0, 7.6) node[draw=none,left] () {$(0,8)$};
            \path (8,4) node[draw=none,right] () {$(8,4)$};
            \path (5.3,7) node[draw=none,above] () {$(5,7)$};

        \end{tikzpicture}
        \caption{直线簇与可行域相切于最优解$(5,7)$处，目标函数最优值为$50$。}
        \label{fig: lp}
    \end{figure}
\end{example}

\section{标准型}

当变量多于$2$个时，图解法就不再适用了，需要更一般性的方法。线性规划的常用求解算法有单纯形法和内点法。前者在最坏情况下是指数复杂度，后者是多项式复杂度，但实际使用中两者几乎没有差别，单纯形法的最坏情况实际中很难遇到。

要想使用单纯形法，需要先将问题转化为标准型(不等式只约束变量非负，其余都是等式约束)：
\begin{align*}
    \begin{array}{rl}
        \max & \cv^\top \xv   \\
        \st  & \Av \xv = \bv  \\
             & \xv \ge \zerov
    \end{array}
\end{align*}
其中
\begin{align*}
    \cv = \begin{bmatrix}
              c_1 \\ \vdots \\ c_n
          \end{bmatrix}, \quad
    \xv = \begin{bmatrix}
              x_1 \\ \vdots \\ x_n
          \end{bmatrix}, \quad
    \Av= \begin{bmatrix}
             a_{11} & \ldots & a_{1n} \\
             \vdots & \ddots & \vdots \\
             a_{m1} & \ldots & a_{mn}
         \end{bmatrix}, \quad
    \bv = \begin{bmatrix}
              b_1 \\ \vdots \\ b_m
          \end{bmatrix}
\end{align*}
这里为了简化表达，将所有线性等式约束合并写成了线性方程组$\Av \xv = \bv$的形式，不失一般性可设
\begin{itemize}
    \item 共有$m$个线性等式约束、$n$个变量，其中$m < n$，否则可行域为单点集或空集；
    \item $\Av$是行满秩矩阵，即$\rank(\Av) = m$，否则存在冗余约束；
    \item $\bv \ge \zerov$，若某个$b_i < 0$，对该约束两边取反即可。
\end{itemize}

对于任何形式的线性规划，都可按以下步骤将其转化成标准型，且两者是等价的：
\begin{itemize}
    \item 对非正变量$x \le 0$，令$y = -x$作为替代；
    \item 对无约束变量$x$，将其表示成两个非负变量的差$x = u - v$；
    \item 对$\av^\top \xv \le b$型不等式约束，引入松弛变量$y \ge 0$将其转化为等式约束$\av^\top \xv + y = b$；
    \item 对$\av^\top \xv \ge b$型不等式约束，引入剩余变量$y \ge 0$将其转化为等式约束$\av^\top \xv - y = b$。
\end{itemize}

下面将例\ref{exam: bag}、例\ref{exam: flow}、例\ref{exam: illustration}中的问题转化为标准型。

\begin{itemize}
    \item 分数背包问题有$5$个$\av^\top \xv \le b$型约束，分别引入松弛变量$x_5, \ldots, x_9$：
          \begin{align}
              \begin{array}{rlcrl} \label{eq: bag-standard}
                  \max & 40 x_1 + 42 x_2 + 25 x_3 + 12 x_4    &                 & \max & 40 x_1 + 42 x_2 + 25 x_3 + 12 x_4        \\
                  \st  & 4 x_1 + 7 x_2 + 5 x_3 + 3 x_4 \le 10 &                 & \st  & 4 x_1 + 7 x_2 + 5 x_3 + 3 x_4 + x_5 = 10 \\
                       & x_1 \le 1                            &                 &      & x_1 + x_6 = 1                            \\
                       & x_2 \le 1                            & \Longrightarrow &      & x_2 + x_7 = 1                            \\
                       & x_3 \le 1                            &                 &      & x_3 + x_8 = 1                            \\
                       & x_4 \le 1                            &                 &      & x_4 + x_9 = 1                            \\
                       & x_i \ge 0, ~ i \in [4]               &                 &      & x_i \ge 0, ~ i \in [9]
              \end{array}
          \end{align}
    \item 最大流问题有$9$个$\av^\top \xv \le b$型约束，分别引入松弛变量$x_{10}, \ldots, x_{18}$：
          \begin{align}
              \begin{array}{rlcrl} \label{eq: flow-standard}
                  \max & x_1 + x_2                 &                 & \max & x_1 + x_2                 \\
                  \st  & x_1 \le 16                &                 & \st  & x_1 + x_{10} = 16         \\
                       & x_2 \le 13                &                 &      & x_2 + x_{11} =  13        \\
                       & x_3 \le 4                 &                 &      & x_3 + x_{12} =  4         \\
                       & x_4 \le 12                &                 &      & x_4 + x_{13} =  12        \\
                       & x_5 \le 9                 &                 &      & x_5 + x_{14} =  9         \\
                       & x_6 \le 14                &                 &      & x_6 + x_{15} =  14        \\
                       & x_7 \le 7                 & \Longrightarrow &      & x_7 + x_{16} =  7         \\
                       & x_8 \le 20                &                 &      & x_8 + x_{17} =  20        \\
                       & x_9 \le 4                 &                 &      & x_9 + x_{18} =  4         \\
                       & x_1 + x_3 - x_4 = 0       &                 &      & x_1 + x_3 - x_4 = 0       \\
                       & x_2 + x_5 - x_3 - x_6 = 0 &                 &      & x_2 + x_5 - x_3 - x_6 = 0 \\
                       & x_4 + x_7 - x_5 - x_8 = 0 &                 &      & x_4 + x_7 - x_5 - x_8 = 0 \\
                       & x_6 - x_7 - x_9 = 0       &                 &      & x_6 - x_7 - x_9 = 0       \\
                       & x_i \ge 0, ~ i \in [9]    &                 &      & x_i \ge 0, ~ i \in [18]
              \end{array}
          \end{align}
    \item 例\ref{exam: illustration}中的线性规划有$3$个$\av^\top \xv \le b$型约束，分别引入松弛变量$x_3, x_4, x_5$：
          \begin{align}
              \begin{array}{rlcrl} \label{eq: illustration-standard}
                  \max & 3 x_1 + 5 x_2          &                 & \max & 3 x_1 + 5 x_2          \\
                  \st  & x_1 + 5 x_2 \le 40     &                 & \st  & x_1 + 5 x_2 + x_3 = 40 \\
                       & 2 x_1 + x_2 \le 20     & \Longrightarrow &      & 2 x_1 + x_2 + x_4 = 20 \\
                       & x_1 + x_2 \le 12       &                 &      & x_1 + x_2 + x_5 = 12   \\
                       & x_i \ge 0, ~ i \in [2] &                 &      & x_i \ge 0, ~ i \in [5]
              \end{array}
          \end{align}
\end{itemize}

\begin{example}
    将如下线性规划转化为标准型
    \begin{align*}
        \begin{array}{rlcrl}
            \max & x_2 - x_1       \\
            \st  & 3 x_1 = x_2 - 5 \\
                 & |x_2| \le 2     \\
                 & x_1 \le 0
        \end{array}
    \end{align*}
    \begin{itemize}
        \item $x_1$非正，令$y_1 = -x_1 \ge 0$作为替代；
        \item $x_2$无约束，令$x_2 = y_2 - y_3$，其中$y_2 \ge 0 $、$y_3 \ge 0$；
    \end{itemize}
    \begin{align*}
        \begin{array}{rlcrl}
            \max & y_2 - y_3 + y_1          &                 & \max & y_1 + y_2 - y_3          \\
            \st  & -3 y_1 = y_2 - y_3 - 5   &                 & \st  & 3 y_1 + y_2 - y_3 = 5    \\
                 & y_2 - y_3 \le 2          & \Longrightarrow &      & y_2 - y_3 + y_4 = 2      \\
                 & -y_2 + y_3 \le 2         &                 &      & -y_2 + y_3 + y_5 = 2     \\
                 & y_i \ge 0, ~ [i] \in [3] &                 &      & y_i \ge 0, ~ [i] \in [5]
        \end{array}
    \end{align*}
\end{example}

\section{基本解}

对于线性规划的标准型，所有可行解是线性方程组$\Av \xv = \bv$的解与第一象限的交集。根据之前的约定矩阵$\Av \in \Rbb^{m \times n}$行满秩且$m < n$，因此它有无穷多个解，但求解线性规划只需要关注其中一类称为\blue{基本解}的解。

记矩阵$\Av$的$n$个列分别为$\av_1, \ldots, \av_n$，由于$\rank(\Av) = m$，因此可以从中挑出$m$个\blue{线性无关}的列$\av_{i_1}, \ldots, \av_{i_m}$构成基$\Bv$，这些列也称为\blue{基向量}，未被选择的$\av_{i_{m+1}}, \ldots, \av_{i_n}$称为\blue{非基向量}。为表述方便，引入矩阵的切片表示$\Av_{\Rcal,\Ccal}$，其中$\Rcal$、$\Ccal$为索引元组，例如记$\Bcal = (i_1, \ldots, i_m)$、$\Dcal = (i_{m+1}, \ldots, i_n)$，则
\begin{align*}
    \Bv = \Av_{:,\Bcal} =
    \begin{bmatrix}
        \av_{i_1} & \cdots & \av_{i_m}
    \end{bmatrix}, \quad
    \Dv = \Av_{:,\Dcal} =
    \begin{bmatrix}
        \av_{i_{m+1}} & \cdots & \av_{i_n}
    \end{bmatrix}, \quad \bv = \Av \xv = \Bv \xv_\Bcal + \Dv \xv_\Dcal
\end{align*}
其中$\xv_\Bcal$称为\blue{基变量}，$\xv_\Dcal$称为\blue{非基变量}。令非基变量$\xv_\Dcal = \zerov$可得$\xv_\Bcal = \Bv^{-1} \bv$，这就得到了$\Av \xv = \bv$在基$\Bv$下的\blue{基本解}。
\begin{itemize}
    \item 如果基本解中某些基变量为零，则称其为\blue{退化}的基本解；
    \item 如果基本解还是线性规划的可行解(满足所有变量非负)，则称其为\blue{基本可行解}。
\end{itemize}

\begin{example}
    设线性规划的等式约束为线性方程组$\Av \xv = \bv$，其中
    \begin{align*}
        \Av = \begin{bmatrix}
                  \av_1 & \av_2 & \av_3 & \av_4
              \end{bmatrix} =
        \begin{bmatrix}
            1 & 1 & -1 & 4 \\ 1 & -2 & -1 & 1
        \end{bmatrix}, \quad \bv =
        \begin{bmatrix}
            8 \\ 2
        \end{bmatrix}
    \end{align*}

    $n=4$、$m=2$，故基本解最多不超过$\binom{4}{2}=6$个，对线性方程组的增广矩阵做初等行变换：
    \begin{align*}
        \begin{bmatrix}
            1 & 1 & -1 & 4 & 8 \\ 1 & -2 & -1 & 1 & 2
        \end{bmatrix} \longrightarrow
        \begin{bmatrix}
            1 & 1 & -1 & 4 & 8 \\ 0 & -3 & 0 & -3 & -6
        \end{bmatrix} \longrightarrow
        \begin{bmatrix}
            1 & 0 & -1 & 3 & 6 \\ 0 & 1 & 0 & 1 & 2
        \end{bmatrix}
    \end{align*}
    因此
    \begin{align*}
        \begin{cases}
            x_1 = x_3 - 3 x_4 + 6 \\
            x_2 = - x_4 + 2
        \end{cases} \Longrightarrow
        \begin{bmatrix}
            x_1 \\ x_2 \\ x_3 \\ x_4
        \end{bmatrix} =
        \begin{bmatrix}
            6 \\ 2 \\ 0 \\ 0
        \end{bmatrix} + s
        \begin{bmatrix}
            1 \\ 0 \\ 1 \\ 0
        \end{bmatrix} + t
        \begin{bmatrix}
            -3 \\ -1 \\ 0 \\ 1
        \end{bmatrix}
    \end{align*}
    \begin{itemize}
        \item 令$s=t=0$，$\xv = \begin{bmatrix}
                      6 & 2 & 0 & 0
                  \end{bmatrix}^\top$，这是关于基$\begin{bmatrix}
                      \av_1 & \av_2
                  \end{bmatrix}$的基本可行解；
        \item 令$s=-6$、$t=0$，$\xv = \begin{bmatrix}
                      0 & 2 & -6 & 0
                  \end{bmatrix}^\top$，这是关于基$\begin{bmatrix}
                      \av_2 & \av_3
                  \end{bmatrix}$的基本解，但不可行；
        \item 令$s=0$、$t=2$，$\xv = \begin{bmatrix}
                      0 & 0 & 0 & 2
                  \end{bmatrix}^\top$，这是同时关于基$\begin{bmatrix}
                      \av_1 & \av_4
                  \end{bmatrix}$、$\begin{bmatrix}
                      \av_2 & \av_4
                  \end{bmatrix}$、$\begin{bmatrix}
                      \av_3 & \av_4
                  \end{bmatrix}$的退化基本可行解；
        \item 令$s=1$、$t=1$，$\xv = \begin{bmatrix}
                      4 & 1 & 1 & 1
                  \end{bmatrix}^\top$，这是可行解，但不是基本解。
    \end{itemize}
    注意$a_1$、$a_3$线性相关，因此前三种情况已经找到所有的基本解了。
\end{example}

\begin{theorem} [线性规划基本定理]
    对于线性规划的标准型，有如下两个命题：
    \begin{enumerate}
        \item 如果存在可行解，则一定存在基本可行解；
        \item 如果存在最优可行解，则一定存在最优基本可行解。
    \end{enumerate}
\end{theorem}

\begin{proof}
    1. 设$\xv$是一个可行解且有$l$个正分量：$\{ i \mid x_i > 0, ~ i \in [n] \} = \{ i_1, \ldots, i_l \} \triangleq \Lcal$，则
    \begin{align} \label{eq: b-coef}
        \bv = \Av \xv = \av_{i_1} x_{i_1} + \cdots + \av_{i_l} x_{i_l}
    \end{align}
    此时分两种情况：
    \begin{itemize}
        \item $\av_{i_1}, \ldots, \av_{i_l}$线性无关，则$l \le m$。若$l = m$，$\xv$就是基本可行解；若$l < m$，从$\Av$的剩余列中挑选$m-l$个列与$\av_{i_1}, \ldots, \av_{i_l}$构成基，此时$\xv$就是对应该基的基本可行解。
        \item $\av_{i_1}, \ldots, \av_{i_l}$线性相关，可以去掉一些冗余列使其线性无关，从而转化为前一种情况。设不全为零的实数$y_{i_1}, \ldots, y_{i_l}$使得
              \begin{align} \label{eq: 0-coef}
                  \zerov = \av_{i_1} y_{i_1} + \cdots + \av_{i_l} y_{i_l}
              \end{align}
              且至少某个$y_{i_k} > 0$，否则对所有的$y_{i_1}, \ldots, y_{i_l}$取反即可，于是对任意$\epsilon$，令$\eqref{eq: b-coef} - \epsilon \times \eqref{eq: 0-coef}$有
              \begin{align*}
                  \bv = \av_{i_1} (x_{i_1} - \epsilon y_{i_1}) + \cdots + \av_{i_l} (x_{i_l} - \epsilon y_{i_l}) = \Av (\xv - \epsilon \yv), \quad
                  \yv_\Lcal^\top \triangleq
                  \begin{bmatrix}
                      y_{i_1} & \cdots & y_{i_l}
                  \end{bmatrix}, \quad \yv_{[n] \setminus \Lcal} = \zerov
              \end{align*}
              让$\epsilon$从$0$增大，对$\yv_\Lcal$的所有正分量，$\xv_\Lcal - \epsilon \yv_\Lcal$在这些分量上单调减。取$\epsilon$使得$\xv_\Lcal - \epsilon \yv_\Lcal$第一次出现某个分量变成$0$，即
              \begin{align*}
                  \epsilon = \min \{ x_{i_k} / y_{i_k} : y_{i_k} > 0, ~ k \in [l] \}
              \end{align*}
              这样就得到了只有$l-1$个正分量的可行解$\xv - \epsilon \yv$，重复该操作直到正分量对应的列线性无关。
    \end{itemize}

    2. 设$\xv$是一个最优可行解且有$l$个正分量：$\{ i \mid x_i > 0, ~ i \in [n] \} = \{ i_1, \ldots, i_l \} \triangleq \Lcal$。

    若$\av_{i_1}, \ldots, \av_{i_l}$线性无关，证明同命题1。若$\av_{i_1}, \ldots, \av_{i_l}$线性相关，可继续沿用命题1中去冗余列的方式，但还需证明对任意$\epsilon$，$\xv - \epsilon \yv$都是最优解，这只需证明$\cv^\top \yv = 0$。注意$\xv_\Lcal > \zerov$，只要
    \begin{align*}
        |\epsilon| \le \min\{ | x_{i_k} / y_{i_k} | : y_{i_k} \ne 0, ~ k \in [l] \} \Longrightarrow \epsilon y_{i_k} \le x_{i_k}, ~ \forall k \in [l]
    \end{align*}
    $\xv - \epsilon \yv$都是可行解，因此若$\cv^\top \yv \ne 0$，根据其符号总能取某个适当的$\epsilon$使得$\cv^\top (\xv - \epsilon \yv) > \cv^\top \xv$，这与$\xv$是最优可行解矛盾。

\end{proof}

根据该定理，线性规划的求解可转化为对基本可行解的搜索问题，依次对基本可行解的最优性进行检查即可。

\section{几何视角}

线性规划的可行域$\Omega = \{ \xv \mid \Av \xv = \bv, ~ \xv \ge \zerov \}$是凸集，因为对$\forall \xv_1, \xv_2 \in \Omega$和$\forall \alpha \in (0,1)$有
\begin{align*}
    \Av (\alpha \xv_1 + (1 - \alpha) \xv_2) = \alpha \Av \xv_1 + (1 - \alpha) \Av \xv_2 = \alpha \bv + (1 - \alpha) \bv = \bv, \quad \alpha \xv_1 + (1 - \alpha) \xv_2 \ge \zerov
\end{align*}
即连接$\Omega$内任意两点的线段依然属于$\Omega$。对凸集$\Omega$中的点$\xv$，若它无法表示成$\Omega$中另外两点的凸组合，则称$\xv$为$\Omega$的\blue{极点}，即
\begin{align*}
    \xv\text{是极点}, ~ \xv = \alpha \xv_1 + (1 - \alpha) \xv_2, ~ \alpha \in (0,1) \Longrightarrow \xv_1 = \xv_2 = \xv
\end{align*}

\begin{theorem} [等价性]
    $\xv$是$\Omega = \{ \xv \mid \Av \xv = \bv, ~ \xv \ge \zerov \}$的极点当且仅当$\xv$是$\Av \xv = \bv, ~ \xv \ge \zerov$的基本可行解。
\end{theorem}

\begin{proof}
    $\Rightarrow$：设$\xv$满足$\Av \xv = \bv, ~ \xv \ge \zerov$且$\{ i \mid x_i > 0, ~ i \in [n] \} = \{ i_1, \ldots, i_l \}$，则
    \begin{align*}
        \av_{i_1} x_{i_1} + \cdots + \av_{i_l} x_{i_l} = \bv
    \end{align*}
    设向量$\yv$满足$\av_{i_1} y_{i_1} + \cdots + \av_{i_l} y_{i_l} = \zerov$且$\yv_{[n]\setminus \Lcal} = \zerov$，于是对任意$\epsilon$有
    \begin{align*}
        \av_{i_1} (x_{i_1} + \epsilon y_{i_1}) + \cdots + \av_{i_l} (x_{i_l} + \epsilon y_{i_l}) & = \bv \\
        \av_{i_1} (x_{i_1} - \epsilon y_{i_1}) + \cdots + \av_{i_l} (x_{i_l} - \epsilon y_{i_l}) & = \bv
    \end{align*}
    注意所有的$x_{i_k}>0$，于是存在$\epsilon \in (0, \min\{ | x_{i_k} / y_{i_k} | : y_{i_k} \ne 0, ~ k \in [l] \}]$使得
    \begin{align*}
        \zv_1 = \xv + \epsilon \yv \in \Omega, \quad \zv_2 = \xv - \epsilon \yv \in \Omega, \quad \xv = \frac{1}{2} \zv_1 + \frac{1}{2} \zv_2
    \end{align*}
    由于$\xv$是极点，因此$\zv_1 = \zv_2 = \xv$，而$\epsilon > 0$，故$\yv = \zerov$。这意味着$\av_{i_1}, \ldots, \av_{i_l}$线性无关，于是$\xv$是基本可行解。

    $\Leftarrow$：设$\xv$是基本可行解，对应基向量为$\av_{i_1}, \ldots, \av_{i_m}$，记$\Bcal = \{i_1, \ldots, i_m\}$、$\Dcal = [n] \setminus \Bcal$，则
    \begin{align*}
        \av_{i_1} x_{i_1} + \cdots + \av_{i_m} x_{i_m} = \bv, \quad \xv_\Dcal = \zerov
    \end{align*}
    若存在$\yv, \zv \in \Omega$、$\alpha \in (0,1)$使得$\xv = \alpha \yv + (1 - \alpha)\zv$，注意$\alpha > 0$、$(1- \alpha) > 0$，故$\yv_\Dcal = \zv_\Dcal = \zerov$且
    \begin{align*}
        \av_{i_1} y_{i_1} + \cdots + \av_{i_m} y_{i_m} = \bv, \quad \av_{i_1} z_{i_1} + \cdots + \av_{i_m} z_{i_m} = \bv
    \end{align*}
    两式相减可得$\av_{i_1} (y_{i_1} - z_{i_1}) + \cdots + \av_{i_m} (y_{i_m} - z_{i_m}) = \zerov$，由于$\av_{i_1}, \ldots, \av_{i_m}$线性无关，故$\yv_\Bcal = \zv_\Bcal$，从而$\yv = \zv$，即$\xv$是极点。
\end{proof}

\begin{example} \label{exam: simplex}
    再看例\ref{exam: illustration}中的线性规划，根据式\eqref{eq: illustration-standard}，其标准型为：
    \begin{align*}
        \begin{array}{rl}
            \max & 3 x_1 + 5 x_2          \\
            \st  & x_1 + 5 x_2 + x_3 = 40 \\
                 & 2 x_1 + x_2 + x_4 = 20 \\
                 & x_1 + x_2 + x_5 = 12   \\
                 & x_i \ge 0, ~ i \in [5]
        \end{array}, \quad \Av \xv =
        \underbrace{\begin{bmatrix}
                            1 \\ 2 \\ 1
                        \end{bmatrix}}_{\av_1} x_1 +
        \underbrace{\begin{bmatrix}
                            5 \\ 1 \\ 1
                        \end{bmatrix}}_{\av_2} x_2 +
        \underbrace{\begin{bmatrix}
                            1 \\ 0 \\ 0
                        \end{bmatrix}}_{\av_3} x_3 +
        \underbrace{\begin{bmatrix}
                            0 \\ 1 \\ 0
                        \end{bmatrix}}_{\av_4} x_4 +
        \underbrace{\begin{bmatrix}
                            0 \\ 0 \\ 1
                        \end{bmatrix}}_{\av_5} x_5 =
        \underbrace{\begin{bmatrix}
                            40 \\ 20 \\ 12
                        \end{bmatrix}}_{\bv}
    \end{align*}

    显然取$\av_3$、$\av_4$、$\av_5$作为基向量，基本可行解是一目了然的(基为单位阵)：
    \begin{align*}
        40 \av_3 + 20 \av_4 + 12 \av_5 = \bv, \quad
        \begin{bmatrix}
            x_1 & x_2 & x_3 & x_4 & x_5 \\
            0   & 0   & 40  & 20  & 12
        \end{bmatrix}
    \end{align*}
    对应原问题$\Rbb^2$中可行域的极点$[0,0]$，目标函数值$0 < 50$，因此还不是最优解。

    根据\blue{迭代改进}的思路，需要从当前极点移动到邻近极点，同时使目标函数值增大。现选择$\av_1$作为新的基向量(\blue{入基})并移除原来的某个基向量(\blue{出基})，注意$\av_1 = \av_3 + 2 \av_4 + \av_5$，于是
    \begin{align*}
        \epsilon \av_1 + (40 - \epsilon) \av_3 + (20 - 2 \epsilon) \av_4 + (12 - \epsilon) \av_5 = \bv, \quad
        \begin{bmatrix}
            x_1      & x_2 & x_3           & x_4             & x_5           \\
            \epsilon & 0   & 40 - \epsilon & 20 - 2 \epsilon & 12 - \epsilon
        \end{bmatrix}
    \end{align*}
    让$\epsilon$从$0$增大，$x_1$变成正数，$x_3$、$x_4$、$x_5$逐渐变小，当$\epsilon$增大到$10$时，$x_4$率先减小到$0$，即$\av_4$出基，得到一个新的基本可行解
    \begin{align*}
        10 \av_1 + 30 \av_3 + 2 \av_5 = \bv, \quad
        \begin{bmatrix}
            x_1 & x_2 & x_3 & x_4 & x_5 \\
            10  & 0   & 30  & 0   & 2
        \end{bmatrix}
    \end{align*}
    对应原问题$\Rbb^2$中可行域的极点$[10,0]$，目标函数值$30 < 50$，依然不是最优解。

    重复前面的操作，现选择$\av_2$作为新的基向量，注意$\av_2 = \frac{1}{2} \av_1 + \frac{9}{2} \av_3 + \frac{1}{2} \av_5$，于是
    \begin{align*}
        \left( 10 - \frac{1}{2} \epsilon \right) \av_1 + \epsilon \av_2 + \left( 30 - \frac{9}{2} \epsilon \right) \av_3 + \left( 2 - \frac{1}{2} \epsilon \right) \av_5 = \bv, \quad
        \begin{bmatrix}
            x_1                       & x_2      & x_3                       & x_4 & x_5                      \\
            10 - \frac{1}{2} \epsilon & \epsilon & 30 - \frac{9}{2} \epsilon & 0   & 2 - \frac{1}{2} \epsilon
        \end{bmatrix}
    \end{align*}
    让$\epsilon$从$0$增大，$x_2$变成正数，$x_1$、$x_3$、$x_5$逐渐变小，当$\epsilon$增大到$4$时，$x_5$率先减小到$0$，即$\av_5$出基，得到一个新的基本可行解
    \begin{align*}
        8 \av_1 + 4 \av_2 + 12 \av_3 = \bv, \quad
        \begin{bmatrix}
            x_1 & x_2 & x_3 & x_4 & x_5 \\
            8   & 4   & 12  & 0   & 0
        \end{bmatrix}
    \end{align*}
    对应原问题$\Rbb^2$中可行域的极点$[8,4]$，目标函数值$44 < 50$，依然不是最优解。

    重复前面的操作，现选择$\av_4$作为新的基向量，注意$\av_4 = \av_1 - \av_2 + 4 \av_3$，于是
    \begin{align*}
        (8 - \epsilon) \av_1 + (4 + \epsilon) \av_2 + (12 - 4 \epsilon) \av_3 + \epsilon \av_4 = \bv, \quad
        \begin{bmatrix}
            x_1          & x_2          & x_3             & x_4      & x_5 \\
            8 - \epsilon & 4 + \epsilon & 12 - 4 \epsilon & \epsilon & 0
        \end{bmatrix}
    \end{align*}
    让$\epsilon$从$0$增大，$x_4$变成正数，$x_1$、$x_3$逐渐变小，当$\epsilon$增大到$3$时，$x_3$率先减小到$0$，即$\av_3$出基，得到一个新的基本可行解
    \begin{align*}
        5 \av_1 + 7 \av_2 + 3 \av_4 = \bv, \quad
        \begin{bmatrix}
            x_1 & x_2 & x_3 & x_4 & x_5 \\
            5   & 7   & 0   & 3   & 0
        \end{bmatrix}
    \end{align*}
    对应原问题$\Rbb^2$中可行域的极点$[5,7]$，目标函数值$50$，这就是最优解。
\end{example}

\begin{remark}
    这种从一个极点转移到另一个极点，迭代改进的操作方式就是单纯形法求线性规划的基本思路，但
    \begin{enumerate}
        \item 如何确定初始的基和基本可行解？
        \item 如何确定每轮的入基向量以改进当前解？
        \item 如何确定当前解为最优解以停止算法？
    \end{enumerate}
\end{remark}

\section{单纯形法}

例\ref{exam: simplex}中每轮迭代都要将$\bv$和入基向量$\av_q$用当前基向量$\av_{i_1}, \ldots, \av_{i_m}$线性表出：
\begin{align*}
    \bv = x_{i_1} \av_{i_1} + \cdots + x_{i_m} \av_{i_m}, \quad \av_q = y_{i_1} \av_{i_1} + \cdots + y_{i_m} \av_{i_m}
\end{align*}
由此得到关于$\epsilon$的恒等式
\begin{align*}
    (x_{i_1} - \epsilon y_{i_1}) \av_{i_1} + \cdots + (x_{i_m} - \epsilon y_{i_m}) \av_{i_m} + \epsilon \av_q = \bv
\end{align*}
让$\epsilon$从$0$增大直到某个$\av_p$出基，其中$p = \argmin_{i_k} \{ x_{i_k} / y_{i_k} : y_{i_k} > 0, ~ k \in [m] \}$。

$\bv$和$\av_q$的线性表出系数如何得到呢？根据线性方程组理论，对$\Av \xv = \bv$的增广矩阵做初等行变换
\begin{align*}
    \begin{bmatrix}
        \Bv & \av_{i_{m+1}} & \cdots & \av_{i_n} & \bv
    \end{bmatrix} \longrightarrow
    \begin{bmatrix}
        \Iv_m & \Bv^{-1} \av_{i_{m+1}} & \cdots & \Bv^{-1} \av_{i_n} & \Bv^{-1} \bv
    \end{bmatrix}
\end{align*}
当基$\Bv$变成单位阵时，$\Bv^{-1} \av_q$和$\Bv^{-1} \bv$就是$\av_q$和$\bv$的线性表出系数。

下面考察基本可行解变化时目标函数值的变化，将标准型根据对$\Av$的分块重写为
\begin{align*}
    \begin{array}{rl}
        \max & \cv_\Bcal^\top \xv_\Bcal + \cv_\Dcal^\top \xv_\Dcal \\
        \st  & \Bv \xv_\Bcal + \Dv \xv_\Dcal = \bv                 \\
             & \xv_\Bcal, \xv_\Dcal \ge \zerov
    \end{array}
\end{align*}
\begin{itemize}
    \item 若$\xv_\Dcal = \zerov$，则$\xv_\Bcal = \Bv^{-1} \bv$，此时$\xv$就是关于基$\Bv$的基本可行解，对应目标函数值为
          \begin{align*}
              \zhat = \cv_\Bcal^\top \xv_\Bcal = \cv_\Bcal^\top \Bv^{-1} \bv
          \end{align*}
    \item 若$\xv_\Dcal \ne \zerov$，则$\xv_\Bcal = \Bv^{-1} \bv - \Bv^{-1} \Dv \xv_\Dcal$，对应目标函数值为
          \begin{align*}
              z = \cv_\Bcal^\top \xv_\Bcal + \cv_\Dcal^\top \xv_\Dcal = \cv_\Bcal^\top (\Bv^{-1} \bv - \Bv^{-1} \Dv \xv_\Dcal) + \cv_\Dcal^\top \xv_\Dcal = \cv_\Bcal^\top \Bv^{-1} \bv - (\cv_\Bcal^\top \Bv^{-1} \Dv - \cv_\Dcal^\top) \xv_\Dcal = \zhat - \rv_\Dcal^\top \xv_\Dcal
          \end{align*}
          其中$\rv_\Dcal^\top = \cv_\Bcal^\top \Bv^{-1} \Dv - \cv_\Dcal^\top$称为\blue{检验数}。

          注意$\xv_\Dcal \ge \zerov$，若$\rv_\Dcal \ge \zerov$，则$z \le \zhat$，即关于基$\Bv$的基本可行解就是最优解，这就回答了前面的问题3。若$\rv_\Dcal$中某个分量为负，则将$\xv_\Dcal$中对应的非基变量从$0$变为正数可使目标函数值变大，因此可取该非基变量对应的列入基，这就回答了前面的问题2。
\end{itemize}

基于此，构造单纯形表
\begin{align*}
    \begin{bmatrix}
        \Av & \bv \\ -\cv^\top & 0
    \end{bmatrix} =
    \begin{bmatrix}
        \Bv & \Dv & \bv \\ -\cv_\Bcal^\top & -\cv_\Dcal^\top & 0
    \end{bmatrix}
\end{align*}
先做初等行变换将基$\Bv$变成单位阵
\begin{align*}
    \begin{bmatrix}
        \Bv^{-1} & \zerov \\ \zerov^\top & 1
    \end{bmatrix}
    \begin{bmatrix}
        \Bv & \Dv & \bv \\ -\cv_\Bcal^\top & -\cv_\Dcal^\top & 0
    \end{bmatrix} =
    \begin{bmatrix}
        \Iv_m & \Bv^{-1} \Dv & \Bv^{-1} \bv \\ -\cv_\Bcal^\top & -\cv_\Dcal^\top & 0
    \end{bmatrix}
\end{align*}
再做初等行变换将最后一行基变量对应的$-\cv_\Bcal^\top$变成$\zerov^\top$
\begin{align*}
    \begin{bmatrix}
        \Iv_m & \zerov \\ \cv_\Bcal^\top & 1
    \end{bmatrix}
    \begin{bmatrix}
        \Iv_m & \Bv^{-1} \Dv & \Bv^{-1} \bv \\ -\cv_\Bcal^\top & -\cv_\Dcal^\top & 0
    \end{bmatrix} =
    \begin{bmatrix}
        \Iv_m & \Bv^{-1} \Dv & \Bv^{-1} \bv \\ \zerov^\top & \cv_\Bcal^\top \Bv^{-1} \Dv - \cv_\Dcal^\top & \cv_\Bcal^\top \Bv^{-1} \bv
    \end{bmatrix}
\end{align*}
这张表里包含了一切我们需要的信息：
\begin{itemize}
    \item $\Bv^{-1} \Dv$里的每列就是当前非基向量在当前基下的线性表出系数；
    \item $\Bv^{-1} \bv$是当前基对应的基本可行解中的基变量值；
    \item $\cv_\Bcal^\top \Bv^{-1} \Dv - \cv_\Dcal^\top$就是检验数，可以指示下一个入基向量和是否已达最优解；
    \item $\cv_\Bcal^\top \Bv^{-1} \bv$就是当前基本可行解对应的目标函数值。
\end{itemize}

\begin{example}
    用单纯形法再求例\ref{exam: illustration}中的线性规划，根据式\eqref{eq: illustration-standard}，初始单纯形表为
    \begin{align*}
        \begin{array}{c|ccccc:c}
                & \av_1 & \av_2 & \av_3 & \av_4 & \av_5      \\ \hline
            x_3 & 1     & 5     & 1     &       &       & 40 \\
            x_4 & 2     & 1     &       & 1     &       & 20 \\
            x_5 & 1     & 1     &       &       & 1     & 12 \\ \hdashline
                & -3    & -5    &       &       &       & 0
        \end{array}
    \end{align*}
    注意此时需要取$3$个线性无关的列组成初始的基，然后做初等行变换将其变成单位阵，因此直接取$\av_3$、$\av_4$、$\av_5$是最省事的，已经是单位阵了，可以少做一次初等行变换：
    \begin{itemize}
        \item 基变量$x_3$、$x_4$、$x_5$的名字在最左列，取值就是最右列的$\bv$
        \item 非基变量$x_1$、$x_2$对应的检验数就是最后一行的$-\cv^\top$
        \item 目标函数值就是右下角的$0$
    \end{itemize}
    基本可行解为
    \begin{align*}
        \begin{bmatrix}
            x_1 & x_2 & x_3 & x_4 & x_5 \\
            0   & 0   & 40  & 20  & 12
        \end{bmatrix}
    \end{align*}
    对应$\Rbb^2$中可行域的极点$[0,0]$，由于检验数还有负值，因此还不是最优解。

    取最小检验数对应的列入基(改进幅度最大)，即$\av_2$入基。注意
    \begin{align*}
        \bv = 40 \av_3 + 20 \av_4 + 12 \av_5, \quad \av_2 = 5 \av_3 + 1 \av_4 + 1 \av_5
    \end{align*}
    计算$\min\{\nicefrac{40}{5}, \nicefrac{20}{1}, \nicefrac{12}{1}\}$可知$\av_3$出基。$\av_2$和$x_3$所在的行的交点$5$称为\blue{主元}，做初等行变换
    \begin{align*}
        \begin{array}{c|ccccc:c}
                & \av_1           & \av_2 & \av_3           & \av_4 & \av_5      \\ \hline
            x_2 & \nicefrac{1}{5} & 1     & \nicefrac{1}{5} &       &       & 8  \\
            x_4 & 2               & 1     &                 & 1     &       & 20 \\
            x_5 & 1               & 1     &                 &       & 1     & 12 \\ \hdashline
                & -3              & -5    &                 &       &       & 0
        \end{array} \Longrightarrow
        \begin{array}{c|ccccc:c}
                & \av_1           & \av_2 & \av_3            & \av_4 & \av_5      \\ \hline
            x_2 & \nicefrac{1}{5} & 1     & \nicefrac{1}{5}  &       &       & 8  \\
            x_4 & \nicefrac{9}{5} &       & \nicefrac{-1}{5} & 1     &       & 12 \\
            x_5 & \nicefrac{4}{5} &       & \nicefrac{-1}{5} &       & 1     & 4  \\ \hdashline
                & -2              &       & 1                &       &       & 40
        \end{array}
    \end{align*}
    基本可行解为
    \begin{align*}
        \begin{bmatrix}
            x_1 & x_2 & x_3 & x_4 & x_5 \\
            0   & 8   & 0   & 12  & 4
        \end{bmatrix}
    \end{align*}
    对应$\Rbb^2$中可行域的极点$[0,8]$，由于检验数还有负值，因此还不是最优解。

    根据检验数$\av_1$入基，计算$\min\{\nicefrac{8}{\nicefrac{1}{5}}, \nicefrac{12}{\nicefrac{9}{5}}, \nicefrac{4}{\nicefrac{4}{5}}\}$可知$\av_5$出基。做初等行变换
    \begin{align*}
        \begin{array}{c|ccccc:c}
                & \av_1           & \av_2 & \av_3            & \av_4 & \av_5                \\ \hline
            x_2 & \nicefrac{1}{5} & 1     & \nicefrac{1}{5}  &       &                 & 8  \\
            x_4 & \nicefrac{9}{5} &       & \nicefrac{-1}{5} & 1     &                 & 12 \\
            x_1 & 1               &       & \nicefrac{-1}{4} &       & \nicefrac{5}{4} & 5  \\ \hdashline
                & -2              &       & 1                &       &                 & 40
        \end{array} \Longrightarrow
        \begin{array}{c|ccccc:c}
                & \av_1 & \av_2 & \av_3            & \av_4 & \av_5                 \\ \hline
            x_2 &       & 1     & \nicefrac{1}{4}  &       & \nicefrac{-1}{4} & 7  \\
            x_4 &       &       & \nicefrac{1}{4}  & 1     & \nicefrac{-9}{4} & 3  \\
            x_1 & 1     &       & \nicefrac{-1}{4} &       & \nicefrac{5}{4}  & 5  \\ \hdashline
                &       &       & \nicefrac{1}{2}  &       & \nicefrac{5}{2}  & 50
        \end{array}
    \end{align*}
    基本可行解为
    \begin{align*}
        \begin{bmatrix}
            x_1 & x_2 & x_3 & x_4 & x_5 \\
            5   & 7   & 0   & 3   & 0
        \end{bmatrix}
    \end{align*}
    对应$\Rbb^2$中可行域的极点$[5,7]$，由于检验数均非负，已达最优解。
\end{example}

\begin{remark}
    注意与例\ref{exam: simplex}中经过的基本可行解的顺序不一样，本例中为
    \begin{align*}
        \begin{bmatrix}
            x_1 & x_2 & x_3 & x_4 & x_5 \\
            0   & 0   & 40  & 20  & 12
        \end{bmatrix} \longrightarrow
        \begin{bmatrix}
            x_1 & x_2 & x_3 & x_4 & x_5 \\
            0   & 8   & 0   & 12  & 4
        \end{bmatrix} \longrightarrow
        \begin{bmatrix}
            x_1 & x_2 & x_3 & x_4 & x_5 \\
            5   & 7   & 0   & 3   & 0
        \end{bmatrix}
    \end{align*}
\end{remark}

\begin{example}
    用单纯形法求例\ref{exam: bag}中的分数背包问题，根据式\eqref{eq: bag-standard}，初始单纯形表为
    \begin{align*}
        \begin{array}{c|ccccccccc:c}
                & \av_1 & \av_2 & \av_3 & \av_4 & \av_5 & \av_6 & \av_7 & \av_8 & \av_9      \\ \hline
            x_5 & 4     & 7     & 5     & 3     & 1     &       &       &       &       & 10 \\
            x_6 & 1     &       &       &       &       & 1     &       &       &       & 1  \\
            x_7 &       & 1     &       &       &       &       & 1     &       &       & 1  \\
            x_8 &       &       & 1     &       &       &       &       & 1     &       & 1  \\
            x_9 &       &       &       & 1     &       &       &       &       & 1     & 1  \\ \hdashline
                & -40   & -42   & -25   & -12   &       &       &       &       &       & 0
        \end{array}
    \end{align*}
    由于$\av_5$、$\av_6$、$\av_7$、$\av_8$、$\av_9$构成单位阵，取其做基，基本可行解为
    \begin{align*}
        \begin{bmatrix}
            x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & x_7 & x_8 & x_9 \\
            0   & 0   & 0   & 0   & 10  & 1   & 1   & 1   & 1
        \end{bmatrix}
    \end{align*}

    根据检验数$\av_2$入基，计算$\min\{\nicefrac{10}{7}, \nicefrac{1}{1}\}$可知$\av_7$出基。做初等行变换
    \begin{align*}
        \begin{array}{c|ccccccccc:c}
                & \av_1 & \av_2 & \av_3 & \av_4 & \av_5 & \av_6 & \av_7 & \av_8 & \av_9      \\ \hline
            x_5 & 4     &       & 5     & 3     & 1     &       & -7    &       &       & 3  \\
            x_6 & 1     &       &       &       &       & 1     &       &       &       & 1  \\
            x_2 &       & 1     &       &       &       &       & 1     &       &       & 1  \\
            x_8 &       &       & 1     &       &       &       &       & 1     &       & 1  \\
            x_9 &       &       &       & 1     &       &       &       &       & 1     & 1  \\ \hdashline
                & -40   &       & -25   & -12   &       &       & 42    &       &       & 42
        \end{array}
    \end{align*}
    基本可行解为
    \begin{align*}
        \begin{bmatrix}
            x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & x_7 & x_8 & x_9 \\
            0   & 1   & 0   & 0   & 3   & 1   & 0   & 1   & 1
        \end{bmatrix}
    \end{align*}

    根据检验数$\av_1$入基，计算$\min\{\nicefrac{3}{4}, \nicefrac{1}{1}\}$可知$\av_5$出基。做初等行变换
    \begin{align*}\arraycolsep=3.2pt
        \begin{array}{c|ccccccccc:c}
                & \av_1 & \av_2 & \av_3           & \av_4           & \av_5           & \av_6 & \av_7            & \av_8 & \av_9                   \\ \hline
            x_1 & 1     &       & \nicefrac{5}{4} & \nicefrac{3}{4} & \nicefrac{1}{4} &       & \nicefrac{-7}{4} &       &       & \nicefrac{3}{4} \\
            x_6 & 1     &       &                 &                 &                 & 1     &                  &       &       & 1               \\
            x_2 &       & 1     &                 &                 &                 &       & 1                &       &       & 1               \\
            x_8 &       &       & 1               &                 &                 &       &                  & 1     &       & 1               \\
            x_9 &       &       &                 & 1               &                 &       &                  &       & 1     & 1               \\ \hdashline
                & -40   &       & -25             & -12             &                 &       & 42               &       &       & 42
        \end{array} \Longrightarrow
        \begin{array}{c|ccccccccc:c}
                & \av_1 & \av_2 & \av_3            & \av_4            & \av_5            & \av_6 & \av_7            & \av_8 & \av_9                   \\ \hline
            x_1 & 1     &       & \nicefrac{5}{4}  & \nicefrac{3}{4}  & \nicefrac{1}{4}  &       & \nicefrac{-7}{4} &       &       & \nicefrac{3}{4} \\
            x_6 &       &       & \nicefrac{-5}{4} & \nicefrac{-3}{4} & \nicefrac{-1}{4} & 1     & \nicefrac{7}{4}  &       &       & \nicefrac{1}{4} \\
            x_2 &       & 1     &                  &                  &                  &       & 1                &       &       & 1               \\
            x_8 &       &       & 1                &                  &                  &       &                  & 1     &       & 1               \\
            x_9 &       &       &                  & 1                &                  &       &                  &       & 1     & 1               \\ \hdashline
                &       &       & 25               & 18               & 10               & 40    & -28              &       &       & 72
        \end{array}
    \end{align*}
    基本可行解为
    \begin{align*}
        \begin{bmatrix}
            x_1             & x_2 & x_3 & x_4 & x_5 & x_6             & x_7 & x_8 & x_9 \\
            \nicefrac{3}{4} & 1   & 0   & 0   & 0   & \nicefrac{1}{4} & 0   & 1   & 1
        \end{bmatrix}
    \end{align*}

    根据检验数$\av_7$入基，计算$\min\{\nicefrac{\nicefrac{1}{4}}{\nicefrac{7}{4}}, \nicefrac{1}{1}\}$可知$\av_6$出基。做初等行变换
    \begin{align*}\arraycolsep=3.2pt
        \begin{array}{c|ccccccccc:c}
                & \av_1 & \av_2 & \av_3            & \av_4            & \av_5            & \av_6 & \av_7            & \av_8 & \av_9                   \\ \hline
            x_1 & 1     &       & \nicefrac{5}{4}  & \nicefrac{3}{4}  & \nicefrac{1}{4}  &       & \nicefrac{-7}{4} &       &       & \nicefrac{3}{4} \\
            x_7 &       &       & \nicefrac{-5}{7} & \nicefrac{-3}{7} & \nicefrac{-1}{7} & 1     & 1                &       &       & \nicefrac{1}{7} \\
            x_2 &       & 1     &                  &                  &                  &       & 1                &       &       & 1               \\
            x_8 &       &       & 1                &                  &                  &       &                  & 1     &       & 1               \\
            x_9 &       &       &                  & 1                &                  &       &                  &       & 1     & 1               \\ \hdashline
                &       &       & 25               & 18               & 10               & 40    & -28              &       &       & 72
        \end{array} \Longrightarrow
        \begin{array}{c|ccccccccc:c}
                & \av_1 & \av_2 & \av_3            & \av_4            & \av_5            & \av_6           & \av_7 & \av_8 & \av_9                   \\ \hline
            x_1 & 1     &       &                  &                  &                  & \nicefrac{7}{4} &       &       &       & 1               \\
            x_7 &       &       & \nicefrac{-5}{7} & \nicefrac{-3}{7} & \nicefrac{-1}{7} & 1               & 1     &       &       & \nicefrac{1}{7} \\
            x_2 &       & 1     & \nicefrac{5}{7}  & \nicefrac{3}{7}  & \nicefrac{1}{7}  & -1              &       &       &       & \nicefrac{6}{7} \\
            x_8 &       &       & 1                &                  &                  &                 &       & 1     &       & 1               \\
            x_9 &       &       &                  & 1                &                  &                 &       &       & 1     & 1               \\ \hdashline
                &       &       & 5                & 6                & 6                & 68              &       &       &       & 76
        \end{array}
    \end{align*}
    基本可行解为
    \begin{align*}
        \begin{bmatrix}
            x_1 & x_2             & x_3 & x_4 & x_5 & x_6 & x_7             & x_8 & x_9 \\
            1   & \nicefrac{6}{7} & 0   & 0   & 0   & 0   & \nicefrac{1}{7} & 1   & 1
        \end{bmatrix}
    \end{align*}
    由于检验数均非负，已达最优解。
\end{example}

\begin{remark}
    四个物品是按单价从高到低排好序的，根据最优解，先装单价最高的物品$1$，用掉$4$个单位重量，剩下$6$个单位重量全部用于装单价次高的物品$2$，事实上分数背包问题是可以用贪心法来做的。
\end{remark}

最后还剩问题1没有回答，前面两个例子只有$\av^\top \xv \le b$型约束，每个约束引入一个松弛变量，天然产生一个单位阵，直接取这个单位阵作为初始基，最右的$\bv$就是基本解中基变量的取值，而我们开始假定了$\bv \ge \zerov$，因此这个基本解也是可行解，从而单纯形法可以由此迭代下去。

当存在其他约束时，初始单纯形表里就没有现成的单位阵了，如果随便取$m$列作为基，如何确保它们线性无关？此外做初等行变换将基变成单位阵，如何确保得到的基本解是可行解？对此可采用下节的两阶段单纯形法。

\section{两阶段单纯形法}

针对线性规划的标准型，构造如下的辅助问题：
\begin{align*}
    \begin{array}{rl}
        \min & \onev^\top \yv      \\
        \st  & \begin{bmatrix}
                   \Av & \Iv_m
               \end{bmatrix}
        \begin{bmatrix}
            \xv \\ \yv
        \end{bmatrix} = \bv        \\
             & \xv, \yv \ge \zerov
    \end{array}
\end{align*}
辅助问题依然是个线性规划标准型，辅助变量$\yv$引入了一个单位阵，因此有一个天然的基本可行解。

\begin{theorem}
    原线性规划问题存在基本可行解当且仅当辅助问题存在一个使目标函数值为$0$的最优解。
\end{theorem}

\begin{proof}
    $\Rightarrow$：

    $\Leftarrow$：
\end{proof}

$\begin{bmatrix}
    \zerov \\ \bv
\end{bmatrix}$

\begin{example}
    用单纯形法求例\ref{exam: flow}中的最大流问题，根据式\eqref{eq: flow-standard}，标准型为：
    \begin{align*}
        \begin{array}{rlcrl}
            \max & x_1 + x_2                 \\
            \st  & x_1 + x_{10} = 16         \\
                 & x_2 + x_{11} =  13        \\
                 & x_3 + x_{12} =  4         \\
                 & x_4 + x_{13} =  12        \\
                 & x_5 + x_{14} =  9         \\
                 & x_6 + x_{15} =  14        \\
                 & x_7 + x_{16} =  7         \\
                 & x_8 + x_{17} =  20        \\
                 & x_9 + x_{18} =  4         \\
                 & x_1 + x_3 - x_4 = 0       \\
                 & x_2 + x_5 - x_3 - x_6 = 0 \\
                 & x_4 + x_7 - x_5 - x_8 = 0 \\
                 & x_6 - x_7 - x_9 = 0       \\
                 & x_i \ge 0, ~ i \in [18]
        \end{array}
    \end{align*}
    共有$18$个变量、$13$个等式约束，因此基变量有$13$个，非基变量有$5$个。初始不妨取$x_1$、$x_2$、$x_4$、$x_5$、$x_7$为非基变量，将基变量由$x_1$、$x_2$、$x_4$、$x_5$、$x_7$表出：
    \begin{align*}
        \begin{array}{rclcl}
            x_3 = -x_1 + x_4      & \Rightarrow & x_1 + x_3 - x_4 = 0                    & \Rightarrow & -x_1 + x_4 + y_3 = 4                  \\
            x_8 = x_4 - x_5 + x_7 & \Rightarrow & -x_4 + x_5 - x_7 + x_8 = 0             & \Rightarrow & x_4 - x_5 + x_7 + y_8 = 20            \\
            x_6 = x_2 + x_5 - x_3 & \Rightarrow & -x_1 - x_2 + x_4 - x_5 + x_6 = 0       & \Rightarrow & x_1 + x_2 - x_4 + x_5 + y_6 = 14      \\
            x_9 = x_6 - x_7       & \Rightarrow & -x_1 - x_2 + x_4 - x_5 + x_7 + x_9 = 0 & \Rightarrow & x_1 + x_2 - x_4 + x_5 - x_7 + y_9 = 4 \\
        \end{array}
    \end{align*}

    初始单纯形表为
    \begin{align*}
        \begin{array}{c|cccccccccccccccccc:c}
                & x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & x_7 & x_8 & x_9 & y_1 & y_2 & y_3 & y_4 & y_5 & y_6 & y_7 & y_8 & y_9      \\ \hline
            x_3 & 1   &     & 1   & -1  &     &     &     &     &     &     &     &     &     &     &     &     &     &     & 0  \\
            x_6 & -1  & -1  &     & 1   & -1  & 1   &     &     &     &     &     &     &     &     &     &     &     &     & 0  \\
            x_8 &     &     &     & -1  & 1   &     & -1  & 1   &     &     &     &     &     &     &     &     &     &     & 0  \\
            x_9 & -1  & -1  &     & 1   & -1  &     & 1   &     & 1   &     &     &     &     &     &     &     &     &     & 0  \\
            y_1 & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 16 \\
            y_2 &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     & 13 \\
            y_3 & -1  &     &     & 1   &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     & 4  \\
            y_4 &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     & 12 \\
            y_5 &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     & 9  \\
            y_6 & 1   & 1   &     & -1  & 1   &     &     &     &     &     &     &     &     &     & 1   &     &     &     & 14 \\
            y_7 &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     & 7  \\
            y_8 &     &     &     & 1   & -1  &     & 1   &     &     &     &     &     &     &     &     &     & 1   &     & 20 \\
            y_9 & 1   & 1   &     & -1  & 1   &     & -1  &     &     &     &     &     &     &     &     &     &     & 1   & 4  \\ \hdashline
                & -1  & -1  &     &     &     &     &     &     &     &     &     &     &     &     &     &     &     &     & 0
        \end{array}
    \end{align*}
    基本可行解为
    \begin{align*}
        \left[
            \begin{array}{cccccccccccccccccc:c}
                x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & x_7 & x_8 & x_9 & y_1 & y_2 & y_3 & y_4 & y_5 & y_6 & y_7 & y_8 & y_9 & o \\
                0   & 0   & 0   & 0   & 0   & 0   & 0   & 0   & 0   & 16  & 13  & 4   & 12  & 9   & 14  & 7   & 20  & 4   & 0
            \end{array} \right]
    \end{align*}
    对应的流网络为
    \begin{figure}[h]
        \centering
        \begin{tikzpicture}

            \pgfmathsetmacro{\l}{3.5};

            \node [point] (s) at (0,0) {$\sv$};
            \path (s) ++(30:\l)  node[point] (v1) {$\vv_1$};
            \path (s) ++(330:\l)  node[point] (v2) {$\vv_2$};
            \path (v1) ++(\l,0)  node[point] (v3) {$\vv_3$};
            \path (v2) ++(\l,0)  node[point] (v4) {$\vv_4$};
            \path (v4) ++(30:\l)  node[point] (t) {$\tv$};

            \draw [arrow] (s) -- (v1) node [above=0pt, sloped, pos=0.5] {$16$};
            \draw [arrow] (s) -- (v2) node [below=0pt, sloped, pos=0.4] {$13$};
            \draw [arrow] (v2) -- (v1) node [above=0pt, sloped, pos=0.5] {$4$};
            \draw [arrow] (v1) -- (v3) node [above=0pt, pos=0.5] {$12$};
            \draw [arrow] (v2) -- (v4) node [below=0pt, pos=0.5] {$14$};
            \draw [arrow] (v4) -- (v3) node [above=0pt, sloped, pos=0.5] {$7$};
            \draw [arrow] (v3) -- (v2) node [above=0pt, sloped, pos=0.5] {$9$};
            \draw [arrow] (v3) -- (t) node [above=0pt, sloped, pos=0.5] {$20$};
            \draw [arrow] (v4) -- (t) node [below=0pt, sloped, pos=0.5] {$4$};

        \end{tikzpicture}
    \end{figure}

    \newpage

    $\av_1$、$\av_2$的检验数均为$-1$，不妨让$\av_2$入基，计算$\argmin\{\nicefrac{13}{1}, \nicefrac{14}{1}, \nicefrac{4}{1}\}$可知$\av_{18}$出基。做初等行变换
    \begin{align*}
        \begin{array}{c|cccccccccccccccccc:c}
                & x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & x_7 & x_8 & x_9 & y_1 & y_2 & y_3 & y_4 & y_5 & y_6 & y_7 & y_8 & y_9      \\ \hline
            x_3 & 1   &     & 1   & -1  &     &     &     &     &     &     &     &     &     &     &     &     &     &     & 0  \\
            x_6 &     &     &     &     &     & 1   & -1  &     &     &     &     &     &     &     &     &     &     & -1  & 4  \\
            x_8 &     &     &     & -1  & 1   &     & -1  & 1   &     &     &     &     &     &     &     &     &     &     & 0  \\
            x_9 &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   & 4  \\
            y_1 & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 16 \\
            y_2 & -1  &     &     & 1   & -1  &     & 1   &     &     &     & 1   &     &     &     &     &     &     & -1  & 9  \\
            y_3 & -1  &     &     & 1   &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     & 4  \\
            y_4 &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     & 12 \\
            y_5 &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     & 9  \\
            y_6 &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     & 1   &     &     & -1  & 10 \\
            y_7 &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     & 7  \\
            y_8 &     &     &     & 1   & -1  &     & 1   &     &     &     &     &     &     &     &     &     & 1   &     & 20 \\
            x_2 & 1   & 1   &     & -1  & 1   &     & -1  &     &     &     &     &     &     &     &     &     &     & 1   & 4  \\ \hdashline
                &     &     &     & -1  & 1   &     & -1  &     &     &     &     &     &     &     &     &     &     & 1   & 4
        \end{array}
    \end{align*}
    当前基本可行解为
    \begin{align*}
        \left[
            \begin{array}{cccccccccccccccccc:c}
                x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & x_7 & x_8 & x_9 & y_1 & y_2 & y_3 & y_4 & y_5 & y_6 & y_7 & y_8 & y_9 & o \\
                0   & 4   & 0   & 0   & 0   & 4   & 0   & 0   & 4   & 16  & 9   & 4   & 12  & 9   & 10  & 7   & 20  & 0   & 4
            \end{array} \right]
    \end{align*}
    对应的流网络为
    \begin{figure}[h]
        \centering
        \begin{tikzpicture}

            \pgfmathsetmacro{\l}{3.5};

            \node [point] (s) at (0,0) {$\sv$};
            \path (s) ++(30:\l)  node[point] (v1) {$\vv_1$};
            \path (s) ++(330:\l)  node[point] (v2) {$\vv_2$};
            \path (v1) ++(\l,0)  node[point] (v3) {$\vv_3$};
            \path (v2) ++(\l,0)  node[point] (v4) {$\vv_4$};
            \path (v4) ++(30:\l)  node[point] (t) {$\tv$};

            \draw [arrow] (s) -- (v1) node [above=0pt, sloped, pos=0.5] {$16$};
            \draw [arrow] (s) -- (v2) node [below=0pt, sloped, pos=0.4] {$4/13$};
            \draw [arrow] (v2) -- (v1) node [above=0pt, sloped, pos=0.5] {$4$};
            \draw [arrow] (v1) -- (v3) node [above=0pt, pos=0.5] {$12$};
            \draw [arrow] (v2) -- (v4) node [below=0pt, pos=0.5] {$4/14$};
            \draw [arrow] (v4) -- (v3) node [above=0pt, sloped, pos=0.5] {$7$};
            \draw [arrow] (v3) -- (v2) node [above=0pt, sloped, pos=0.5] {$9$};
            \draw [arrow] (v3) -- (t) node [above=0pt, sloped, pos=0.5] {$20$};
            \draw [arrow] (v4) -- (t) node [below=0pt, sloped, pos=0.5] {$4/4$};

        \end{tikzpicture}
    \end{figure}

    \newpage

    $\av_4$、$\av_7$的检验数均为$-1$，不妨让$\av_7$入基，计算$\argmin\{\nicefrac{9}{1}, \nicefrac{10}{1}, \nicefrac{7}{1}, \nicefrac{20}{1}\}$可知$\av_{16}$出基。做初等行变换
    \begin{align*}
        \begin{array}{c|cccccccccccccccccc:c}
                & x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & x_7 & x_8 & x_9 & y_1 & y_2 & y_3 & y_4 & y_5 & y_6 & y_7 & y_8 & y_9      \\ \hline
            x_3 & 1   &     & 1   & -1  &     &     &     &     &     &     &     &     &     &     &     &     &     &     & 0  \\
            x_6 &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     &     & 1   &     & -1  & 11 \\
            x_8 &     &     &     & -1  & 1   &     &     & 1   &     &     &     &     &     &     &     & 1   &     &     & 7  \\
            x_9 &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   & 4  \\
            y_1 & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 16 \\
            y_2 & -1  &     &     & 1   & -1  &     &     &     &     &     & 1   &     &     &     &     & -1  &     & -1  & 2  \\
            y_3 & -1  &     &     & 1   &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     & 4  \\
            y_4 &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     & 12 \\
            y_5 &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     & 9  \\
            y_6 &     &     &     &     &     &     &     &     &     &     &     &     &     &     & 1   & -1  &     & -1  & 3  \\
            x_7 &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     & 7  \\
            y_8 &     &     &     & 1   & -1  &     &     &     &     &     &     &     &     &     &     & -1  & 1   &     & 13 \\
            x_2 & 1   & 1   &     & -1  & 1   &     &     &     &     &     &     &     &     &     &     & 1   &     & 1   & 11 \\ \hdashline
                &     &     &     & -1  & 1   &     &     &     &     &     &     &     &     &     &     & 1   &     & 1   & 11
        \end{array}
    \end{align*}
    当前基本可行解为
    \begin{align*}
        \left[
            \begin{array}{cccccccccccccccccc:c}
                x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & x_7 & x_8 & x_9 & y_1 & y_2 & y_3 & y_4 & y_5 & y_6 & y_7 & y_8 & y_9 & o  \\
                0   & 11  & 0   & 0   & 0   & 11  & 7   & 7   & 4   & 16  & 2   & 4   & 12  & 9   & 3   & 0   & 13  & 0   & 11
            \end{array} \right]
    \end{align*}
    对应的流网络为
    \begin{figure}[h]
        \centering
        \begin{tikzpicture}

            \pgfmathsetmacro{\l}{3.5};

            \node [point] (s) at (0,0) {$\sv$};
            \path (s) ++(30:\l)  node[point] (v1) {$\vv_1$};
            \path (s) ++(330:\l)  node[point] (v2) {$\vv_2$};
            \path (v1) ++(\l,0)  node[point] (v3) {$\vv_3$};
            \path (v2) ++(\l,0)  node[point] (v4) {$\vv_4$};
            \path (v4) ++(30:\l)  node[point] (t) {$\tv$};

            \draw [arrow] (s) -- (v1) node [above=0pt, sloped, pos=0.5] {$16$};
            \draw [arrow] (s) -- (v2) node [below=0pt, sloped, pos=0.4] {$11/13$};
            \draw [arrow] (v2) -- (v1) node [above=0pt, sloped, pos=0.5] {$4$};
            \draw [arrow] (v1) -- (v3) node [above=0pt, pos=0.5] {$12$};
            \draw [arrow] (v2) -- (v4) node [below=0pt, pos=0.5] {$11/14$};
            \draw [arrow] (v4) -- (v3) node [above=0pt, sloped, pos=0.5] {$7/7$};
            \draw [arrow] (v3) -- (v2) node [above=0pt, sloped, pos=0.5] {$9$};
            \draw [arrow] (v3) -- (t) node [above=0pt, sloped, pos=0.5] {$7/20$};
            \draw [arrow] (v4) -- (t) node [below=0pt, sloped, pos=0.5] {$4/4$};

        \end{tikzpicture}
    \end{figure}

    \newpage

    根据检验数$\av_4$入基，计算$\argmin\{\nicefrac{2}{1}, \nicefrac{4}{1}, \nicefrac{12}{1}, \nicefrac{13}{1}\}$可知$\av_{11}$出基。做初等行变换
    \begin{align*}
        \begin{array}{c|cccccccccccccccccc:c}
                & x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & x_7 & x_8 & x_9 & y_1 & y_2 & y_3 & y_4 & y_5 & y_6 & y_7 & y_8 & y_9      \\ \hline
            x_3 &     &     & 1   &     & -1  &     &     &     &     &     & 1   &     &     &     &     & -1  &     & -1  & 2  \\
            x_6 &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     &     & 1   &     & -1  & 11 \\
            x_8 & -1  &     &     &     &     &     &     & 1   &     &     & 1   &     &     &     &     &     &     & -1  & 9  \\
            x_9 &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   & 4  \\
            y_1 & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 16 \\
            x_4 & -1  &     &     & 1   & -1  &     &     &     &     &     & 1   &     &     &     &     & -1  &     & -1  & 2  \\
            y_3 &     &     &     &     & 1   &     &     &     &     &     & -1  & 1   &     &     &     & 1   &     & 1   & 2  \\
            y_4 & 1   &     &     &     & 1   &     &     &     &     &     & -1  &     & 1   &     &     & 1   &     & 1   & 10 \\
            y_5 &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     & 9  \\
            y_6 &     &     &     &     &     &     &     &     &     &     &     &     &     &     & 1   & -1  &     & -1  & 3  \\
            x_7 &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     & 7  \\
            y_8 & 1   &     &     &     &     &     &     &     &     &     & -1  &     &     &     &     &     & 1   & 1   & 11 \\
            x_2 &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     & 13 \\ \hdashline
                & -1  &     &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     & 13
        \end{array}
    \end{align*}
    当前基本可行解为
    \begin{align*}
        \left[
            \begin{array}{cccccccccccccccccc:c}
                x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & x_7 & x_8 & x_9 & y_1 & y_2 & y_3 & y_4 & y_5 & y_6 & y_7 & y_8 & y_9 & o  \\
                0   & 13  & 2   & 2   & 0   & 11  & 7   & 9   & 4   & 16  & 0   & 2   & 10  & 9   & 3   & 0   & 11  & 0   & 13
            \end{array} \right]
    \end{align*}
    对应的流网络为
    \begin{figure}[h]
        \centering
        \begin{tikzpicture}

            \pgfmathsetmacro{\l}{3.5};

            \node [point] (s) at (0,0) {$\sv$};
            \path (s) ++(30:\l)  node[point] (v1) {$\vv_1$};
            \path (s) ++(330:\l)  node[point] (v2) {$\vv_2$};
            \path (v1) ++(\l,0)  node[point] (v3) {$\vv_3$};
            \path (v2) ++(\l,0)  node[point] (v4) {$\vv_4$};
            \path (v4) ++(30:\l)  node[point] (t) {$\tv$};

            \draw [arrow] (s) -- (v1) node [above=0pt, sloped, pos=0.5] {$16$};
            \draw [arrow] (s) -- (v2) node [below=0pt, sloped, pos=0.4] {$13/13$};
            \draw [arrow] (v2) -- (v1) node [above=0pt, sloped, pos=0.5] {$2/4$};
            \draw [arrow] (v1) -- (v3) node [above=0pt, pos=0.5] {$2/12$};
            \draw [arrow] (v2) -- (v4) node [below=0pt, pos=0.5] {$11/14$};
            \draw [arrow] (v4) -- (v3) node [above=0pt, sloped, pos=0.5] {$7/7$};
            \draw [arrow] (v3) -- (v2) node [above=0pt, sloped, pos=0.5] {$9$};
            \draw [arrow] (v3) -- (t) node [above=0pt, sloped, pos=0.5] {$9/20$};
            \draw [arrow] (v4) -- (t) node [below=0pt, sloped, pos=0.5] {$4/4$};

        \end{tikzpicture}
    \end{figure}

    \newpage

    根据检验数$\av_1$入基，计算$\argmin\{\nicefrac{16}{1}, \nicefrac{10}{1}, \nicefrac{11}{1}\}$可知$\av_{13}$出基。做初等行变换
    \begin{align*}
        \begin{array}{c|cccccccccccccccccc:c}
                & x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & x_7 & x_8 & x_9 & y_1 & y_2 & y_3 & y_4 & y_5 & y_6 & y_7 & y_8 & y_9      \\ \hline
            x_3 &     &     & 1   &     & -1  &     &     &     &     &     & 1   &     &     &     &     & -1  &     & -1  & 2  \\
            x_6 &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     &     & 1   &     & -1  & 11 \\
            x_8 &     &     &     &     & 1   &     &     & 1   &     &     &     &     & 1   &     &     & 1   &     &     & 19 \\
            x_9 &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   & 4  \\
            y_1 &     &     &     &     & -1  &     &     &     &     & 1   & 1   &     & -1  &     &     & -1  &     & -1  & 6  \\
            x_4 &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     & 12 \\
            y_3 &     &     &     &     & 1   &     &     &     &     &     & -1  & 1   &     &     &     & 1   &     & 1   & 2  \\
            x_1 & 1   &     &     &     & 1   &     &     &     &     &     & -1  &     & 1   &     &     & 1   &     & 1   & 10 \\
            y_5 &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     & 9  \\
            y_6 &     &     &     &     &     &     &     &     &     &     &     &     &     &     & 1   & -1  &     & -1  & 3  \\
            x_7 &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     & 7  \\
            y_8 &     &     &     &     & -1  &     &     &     &     &     &     &     & -1  &     &     & -1  & 1   &     & 1  \\
            x_2 &     & 1   &     &     &     &     &     &     &     &     & 1   &     &     &     &     &     &     &     & 13 \\ \hdashline
                &     &     &     &     & 1   &     &     &     &     &     &     &     & 1   &     &     & 1   &     & 1   & 23
        \end{array}
    \end{align*}
    当前基本可行解为
    \begin{align*}
        \left[
            \begin{array}{cccccccccccccccccc:c}
                x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & x_7 & x_8 & x_9 & y_1 & y_2 & y_3 & y_4 & y_5 & y_6 & y_7 & y_8 & y_9 & o  \\
                10  & 13  & 2   & 12  & 0   & 11  & 7   & 19  & 4   & 6   & 0   & 2   & 0   & 9   & 3   & 0   & 1   & 0   & 23
            \end{array} \right]
    \end{align*}
    对应的流网络为
    \begin{figure}[h]
        \centering
        \begin{tikzpicture}

            \pgfmathsetmacro{\l}{3.5};

            \node [point] (s) at (0,0) {$\sv$};
            \path (s) ++(30:\l)  node[point] (v1) {$\vv_1$};
            \path (s) ++(330:\l)  node[point] (v2) {$\vv_2$};
            \path (v1) ++(\l,0)  node[point] (v3) {$\vv_3$};
            \path (v2) ++(\l,0)  node[point] (v4) {$\vv_4$};
            \path (v4) ++(30:\l)  node[point] (t) {$\tv$};

            \draw [arrow] (s) -- (v1) node [above=0pt, sloped, pos=0.5] {$10/16$};
            \draw [arrow] (s) -- (v2) node [below=0pt, sloped, pos=0.4] {$13/13$};
            \draw [arrow] (v2) -- (v1) node [above=0pt, sloped, pos=0.5] {$2/4$};
            \draw [arrow] (v1) -- (v3) node [above=0pt, pos=0.5] {$12/12$};
            \draw [arrow] (v2) -- (v4) node [below=0pt, pos=0.5] {$11/14$};
            \draw [arrow] (v4) -- (v3) node [above=0pt, sloped, pos=0.5] {$7/7$};
            \draw [arrow] (v3) -- (v2) node [above=0pt, sloped, pos=0.5] {$9$};
            \draw [arrow] (v3) -- (t) node [above=0pt, sloped, pos=0.5] {$19/20$};
            \draw [arrow] (v4) -- (t) node [below=0pt, sloped, pos=0.5] {$4/4$};

        \end{tikzpicture}
    \end{figure}

    由于检验数均非负，已达最优解。

\end{example}

\begin{remark}
    在最大流的例子中，初始单纯形表中不存在单位阵，需先做一步初等行变换，也可采用两阶段单纯形法。
\end{remark}

\end{document}









